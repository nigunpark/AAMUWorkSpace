<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="aamu.mybatis.mapper.adminCommu">

	<!-- 글 목록용 -->
	<select id="commuSelectList" resultType="commuDTO" >
		select * from community
	</select>
	
	<!-- 글 목록용_댓글 한개 뿌려주기 -->
	<select id="commuCommentSelectOne" parameterType="String" resultType="commuCommentDTO" >
		SELECT * FROM commucomment WHERE lno=#{lno} AND ROWNUM = 1
	</select>
	
	<!-- 글 목록용_사진 뿌려주기 -->
	<select id="commuSelectPhotoList" parameterType="String" resultType="String">
		SELECT photo FROM commuphoto WHERE lno=#{lno}
	</select>
	
	<!-- 글 생성용 -->
	<insert id="commuInsert" parameterType="Map">
		INSERT INTO community
		VALUES (SEQ_COM.NEXTVAL,#{id},#{title},#{content},DEFAULT,DEFAULT,DEFAULT)
		<selectKey keyProperty="lno" resultType="int" order="AFTER">
	    	SELECT SEQ_COM.CURRVAL FROM DUAL
	    </selectKey>
	</insert>
	
	<!-- 글 생성용_사진 저장 -->
	<insert id="commuPhotoInsert" parameterType="Map" >
		INSERT INTO commuphoto
		VALUES (#{lno},#{photo})
	</insert>
	
	<!-- 글 생성용_장소 저장 -->
	<insert id="commuPlaceInsert" parameterType="String" >
		INSERT INTO commuplace
		VALUES (#{lno},#{place})
	</insert>
	
	<!-- !!!!!!!글 생성용_장소 뿌려주기 -->
	<select id="commuPlaceList" resultType="String" parameterType="Map">
		SELECT title, addr, contentid FROM places WHERE title LIKE '%{searchWord}%' or addr LIKE '%{searchWord}%'
	</select>
	
	<!-- 글 수정용 -->
	<update id="commuUpdate" parameterType="CommuDTO">
		UPDATE community SET title=#{title},content=#{content} WHERE lno=#{lno}
	</update>
	
	<!-- 글 수정용_사진 수정 -->
	<update id="commuPlaceUpdate" parameterType="CommuDTO">
		UPDATE commuplace SET lno=#{lno},content=#{content} WHERE lno=#{lno}
	</update>
	
	
	
	
</mapper>